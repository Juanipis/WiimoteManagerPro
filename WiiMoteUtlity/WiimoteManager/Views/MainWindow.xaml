<Window x:Class="WiimoteManager.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:WiimoteManager"
        Title="Wiimote Manager Pro"
        MinWidth="1100"
        MinHeight="700"
        Width="1400"
        Height="900"
        Background="{StaticResource WindowBackgroundBrush}"
        Foreground="{StaticResource TextBrush}"
        WindowStartupLocation="CenterScreen">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" MinHeight="80"/>
            <RowDefinition Height="Auto" MinHeight="80"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto" MinHeight="40"/>
        </Grid.RowDefinitions>

        <!-- Header Panel with Gradient -->
        <Border Grid.Row="0">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#151515" Offset="0.0"/>
                    <GradientStop Color="#202020" Offset="1.0"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect Color="Black" BlurRadius="20" ShadowDepth="5" Opacity="0.5"/>
            </Border.Effect>
            <Grid Margin="30,20">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Grid.Column="0" VerticalAlignment="Center">
                    <TextBlock FontSize="32" FontWeight="Bold" Foreground="{StaticResource AccentBrush}"
                               TextTrimming="CharacterEllipsis" TextWrapping="NoWrap">
                        <Run Text="üéÆ Wiimote Manager Pro"/>
                    </TextBlock>
                    <TextBlock FontSize="14" Foreground="{StaticResource SecondaryTextBrush}" Margin="0,5,0,0"
                               TextTrimming="CharacterEllipsis" TextWrapping="NoWrap">
                        <Run Text="Professional Nintendo Wiimote Management ‚Ä¢ Xbox 360 Emulation ‚Ä¢ Smart Profile System"/>
                    </TextBlock>
                </StackPanel>
                
                <!-- Version Badge & Help -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0,0,0">
                    <Button Command="{Binding OpenHelpCommand}" 
                            Style="{StaticResource SecondaryButton}" 
                            Padding="15,5" 
                            Margin="0,0,10,0"
                            ToolTip="Open Help &amp; Connection Guide">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="‚ùì" Margin="0,0,5,0"/>
                            <TextBlock Text="Help"/>
                        </StackPanel>
                    </Button>
                    <Border Background="{StaticResource SurfaceBrush}" CornerRadius="15" Padding="15,5">
                        <TextBlock Text="{Binding AppVersion}" Foreground="White" FontWeight="Bold"/>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Control Panel -->
        <Border Grid.Row="1" Background="{StaticResource CardBackgroundBrush}" BorderBrush="{StaticResource ButtonBorderBrush}" BorderThickness="0,0,0,1" Padding="0,15">
            <Grid Margin="30,0" VerticalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Button Panel -->
                <WrapPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <!-- Scan Button -->
                    <Button x:Name="ScanButton"
                            Command="{Binding ScanDevicesCommand}"
                            Style="{StaticResource PrimaryButton}"
                            Padding="20,10"
                            Margin="0,0,15,0"
                            ToolTip="Connect to paired Wiimotes">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="üì°" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Connect" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Disconnect All Button -->
                    <Button x:Name="DisconnectButton"
                            Command="{Binding DisconnectAllCommand}"
                            Style="{StaticResource DangerButton}"
                            Padding="20,10"
                            Margin="0,0,15,0"
                            ToolTip="Disconnect all Wiimotes">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="‚èπÔ∏è" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Disconnect" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>

                    <!-- Clear Button -->
                    <Button x:Name="ClearButton"
                            Command="{Binding ClearDiscoveredDevicesCommand}"
                            Style="{StaticResource SecondaryButton}"
                            Padding="20,10"
                            Margin="0,0,15,0"
                            ToolTip="Clear device list">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="üßπ" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Clear" FontSize="14" FontWeight="SemiBold" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                    
                    <!-- Profile Manager Button -->
                    <Button x:Name="ProfileManagerButton"
                            Command="{Binding OpenProfileManagerCommand}"
                            Background="#663399"
                            Foreground="White"
                            BorderThickness="0"
                            Padding="20,10"
                            Margin="0,0,15,0"
                            Cursor="Hand"
                            ToolTip="Manage profiles and templates"
                            FontWeight="SemiBold"
                            FontSize="14">
                        <Button.Effect>
                            <DropShadowEffect Color="#663399" BlurRadius="10" ShadowDepth="2" Opacity="0.4"/>
                        </Button.Effect>
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Border x:Name="border" Background="{TemplateBinding Background}" 
                                        CornerRadius="6" Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter TargetName="border" Property="Background" Value="#7744AA"/>
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="‚öôÔ∏è" FontSize="16" Margin="0,0,10,0" VerticalAlignment="Center"/>
                            <TextBlock Text="Profiles" VerticalAlignment="Center"/>
                        </StackPanel>
                    </Button>
                </WrapPanel>

                <!-- Status Indicators -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15,8" Margin="0,0,15,0">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="10" Height="10" Fill="{StaticResource AccentBrush}" Margin="0,0,10,0"/>
                            <TextBlock Text="Connected: " Foreground="{StaticResource SecondaryTextBrush}"/>
                            <TextBlock Text="{Binding ConnectedWiimotes.Count}" Foreground="White" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                    
                    <Border Background="{StaticResource SurfaceBrush}" CornerRadius="8" Padding="15,8">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="10" Height="10" Fill="{StaticResource WarningBrush}" Margin="0,0,10,0"/>
                            <TextBlock Text="Discovered: " Foreground="{StaticResource SecondaryTextBrush}"/>
                            <TextBlock Text="{Binding DiscoveredDeviceCount}" Foreground="White" FontWeight="Bold"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Main Content Area with Tabs -->
        <Grid Grid.Row="2" Background="{StaticResource WindowBackgroundBrush}">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*" MinWidth="400"/>
                <ColumnDefinition Width="1*" MinWidth="300" MaxWidth="450"/>
            </Grid.ColumnDefinitions>

            <!-- Devices Area -->
            <Grid Grid.Column="0" Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" MinHeight="35"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Status Bar -->
                <Border Grid.Row="0" Background="Transparent" Padding="10,5">
                    <TextBlock VerticalAlignment="Center" Foreground="{StaticResource WarningBrush}" 
                               Text="{Binding StatusMessage}" FontSize="13" FontWeight="SemiBold"
                               TextTrimming="CharacterEllipsis" TextWrapping="NoWrap">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="Orange" BlurRadius="5" ShadowDepth="0" Opacity="0.5"/>
                        </TextBlock.Effect>
                    </TextBlock>
                </Border>

                <!-- Devices List -->
                <ScrollViewer Grid.Row="1" Margin="0,10,0,0" Background="Transparent" VerticalScrollBarVisibility="Auto">
                    <ItemsControl ItemsSource="{Binding ConnectedWiimotes}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal" Margin="0"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <local:WiimoteCard/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

                <!-- Empty State -->
                <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center"
                           Visibility="{Binding ConnectedWiimotes.Count, Converter={StaticResource EmptyCollectionConverter}, Mode=OneWay}"
                           Margin="20" MaxWidth="500">
                    <TextBlock FontSize="64" Foreground="#333333" TextAlignment="Center">üéÆ</TextBlock>
                    <TextBlock FontSize="24" Foreground="#666666" TextAlignment="Center" Margin="0,10,0,0" FontWeight="Light">
                        No Wiimotes Connected
                    </TextBlock>
                    <Border Background="{StaticResource CardBackgroundBrush}" CornerRadius="8" Margin="0,20,0,0" Padding="20">
                        <StackPanel>
                            <TextBlock FontSize="14" Foreground="{StaticResource SecondaryTextBrush}" TextAlignment="Left" LineHeight="24">
                                <Run FontWeight="Bold" Foreground="{StaticResource TextBrush}">Quick Connect (Windows 11):</Run><LineBreak/>
                                1. Open <Run Foreground="White">Win+R</Run>, type <Run Foreground="Cyan">devicepairingwizard</Run><LineBreak/>
                                2. Press red <Run Foreground="#FF4444" FontWeight="Bold">SYNC</Run> button on Wiimote<LineBreak/>
                                3. Pair with <Run Foreground="White">Nintendo RVL-CNT-01</Run> (No PIN)<LineBreak/>
                                4. Click <Run Foreground="{StaticResource AccentBrush}" FontWeight="Bold">Connect</Run> above<LineBreak/><LineBreak/>
                                <Run FontWeight="Bold" Foreground="#FFB900">‚ö†Ô∏è IMPORTANT:</Run> Use original Nintendo Wiimotes.<LineBreak/>
                                Third-party clones often fail to pair.
                            </TextBlock>
                            <Button Content="Show Full Guide" Command="{Binding OpenHelpCommand}" 
                                    Style="{StaticResource SecondaryButton}" HorizontalAlignment="Center" Margin="0,15,0,0"/>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Grid>

            <!-- Right Panel: Log/Info -->
            <Border Grid.Column="1" Background="{StaticResource CardBackgroundBrush}" Margin="10" CornerRadius="12" BorderBrush="{StaticResource ButtonBorderBrush}" BorderThickness="1">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" MinHeight="40"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Log Tab Header -->
                    <Border Grid.Row="0" Background="{StaticResource SurfaceBrush}" CornerRadius="12,12,0,0" BorderBrush="{StaticResource ButtonBorderBrush}" BorderThickness="0,0,0,1">
                        <DockPanel LastChildFill="False">
                            <TextBlock Margin="15,12" FontSize="13" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" VerticalAlignment="Center">
                                <Run Text="üìù System Log"/>
                            </TextBlock>
                        </DockPanel>
                    </Border>

                    <!-- Log Content with ScrollViewer -->
                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="10"
                                  x:Name="LogScrollViewer">
                        <TextBox Text="{Binding DebugLog, Mode=OneWay}" 
                                 IsReadOnly="True"
                                 Background="Transparent"
                                 Foreground="#00FF00"
                                 BorderThickness="0"
                                 FontFamily="Consolas"
                                 FontSize="11"
                                 TextWrapping="Wrap"
                                 VerticalScrollBarVisibility="Auto"
                                 AcceptsReturn="True"/>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- Footer -->
        <Border Grid.Row="3" Background="{StaticResource HeaderBackgroundBrush}" BorderBrush="{StaticResource ButtonBorderBrush}" BorderThickness="0,1,0,0">
            <Grid>
                <TextBlock Margin="20,12" VerticalAlignment="Center" FontSize="11" Foreground="{StaticResource SecondaryTextBrush}">
                    <Run Text="Ready"/>
                </TextBlock>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Margin="20,0">
                    <TextBlock VerticalAlignment="Center" FontSize="11" Foreground="{StaticResource SecondaryTextBrush}" Text="{Binding FooterVersionText}"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
